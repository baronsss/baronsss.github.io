<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Invitati</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <style>
        #settings-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Rendere l'input per numero di invitati più responsive */
        .input-group {
            max-width: 100%;
        }

        /* Migliorare la visibilità dei bottoni e il layout */
        .btn {
            width: 100%;
        }

        /* Assicurati che il testo dell'invito e la lista si adattino bene su schermi piccoli */
        #elenco {
            max-width: 100%;
        }

        /* Aggiungi margini e padding per una visualizzazione più coerente */
        .container {
            padding-left: 10px;
            padding-right: 10px;
        }

        /* Altre piccole modifiche di styling per migliorare la leggibilità */
        .modal-content {
            border-radius: 10px;
        }
    </style>
</head>
<body class="container mt-4 text-center">
    <span id="settings-icon" data-bs-toggle="modal" data-bs-target="#settingsModal">⚙️</span>
    <h1 class="mb-4">Crea la tua lista di invitati</h1>
    
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">Impostazioni</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="customMessaggio" class="form-label">Messaggio di invito personalizzato:</label>
                    <textarea id="customMessaggio" class="form-control" rows="3" placeholder="Es. Sei invitato alla mia festa! ..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
                    <button class="btn btn-info" onclick="salvaMessaggio()">Salva Messaggio</button>
                </div>
            </div>
        </div>
    </div>

	<div class="mb-3">
		<label for="numeroTotale" class="form-label">Numero totale di invitati:</label>
		<input type="number" id="numeroTotale" class="form-control w-100 mx-auto" min="1" style="text-align:center;">
		<button class="btn btn-primary mt-2" onclick="impostaNumero()">Imposta</button>
		<p id="counter" class="mt-2" style="font-weight: bold; color: green; display: none;">
			Persone restanti: <span id="personeRestanti"></span>
		</p>
	</div>
    
    <div id="lista" class="mt-4" style="display:none;">
        <h2>Inserisci i nomi:</h2>
        <div class="input-group mb-3 w-100 mx-auto">
            <input type="text" id="nome" class="form-control" placeholder="Nome o Famiglia" style="width:70%;">
            <input type="number" id="numeroPersone" class="form-control" placeholder="N. Persone" min="1" value="1" style="text-align:center;">
        </div>
		<button class="btn btn-success" onclick="aggiungiNome()">Aggiungi</button>
        <ul id="elenco" class="list-group w-100 mx-auto mt-4"></ul>
        <p id="messaggio" class="mt-3 text-success fw-bold" style="display: none;"></p>
        
        <textarea id="invito" class="form-control mt-3" rows="4" readonly style="display: none;"></textarea>
        <button id="copiaInvito" class="btn btn-secondary mt-2" style="display: none;" onclick="copiaTesto()">Copia Invito</button>
    </div>
    
    <script>
        let numeroTotale = 0;
        let nomi = [];
        let personeTotali = 0;
        let messaggioBase = "Sei invitato al nostro evento! Gli ospiti confermati sono: {ospiti}. Ti aspettiamo!";

        function impostaNumero() {
			numeroTotale = parseInt(document.getElementById("numeroTotale").value);
			if (numeroTotale > 0) {
				document.getElementById("lista").style.display = "block";
				document.getElementById("counter").style.display = "block"; // Mostra il contatore
				aggiornaCounter(); // Aggiorna il contatore subito dopo l'impostazione
			}
		}
		
		function salvaMessaggio() {
            let customMessaggio = document.getElementById("customMessaggio").value.trim();
            if (customMessaggio) {
                messaggioBase = customMessaggio;
                alert("Messaggio personalizzato salvato!");
            }
        }
		
        function aggiungiNome() {
			let nome = document.getElementById("nome").value.trim();
			let numeroPersone = parseInt(document.getElementById("numeroPersone").value);
			
			if (nome && numeroPersone > 0 && (personeTotali + numeroPersone) <= numeroTotale) {
				nomi.push({ nome, numeroPersone });
				personeTotali += numeroPersone;
				aggiornaLista();
				aggiornaCounter(); // Aggiorna il contatore
			}
			
			document.getElementById("nome").value = "";
			document.getElementById("numeroPersone").value = "1";
		}

        function aggiornaLista() {
			let elenco = document.getElementById("elenco");
			elenco.innerHTML = "";
			
			nomi.forEach((item, index) => {
				let li = document.createElement("li");
				li.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center");
				
				let span = document.createElement("span");
				span.textContent = `${item.nome} (${item.numeroPersone})`;
				
				let div = document.createElement("div");
				div.classList.add("d-flex");
				
				let btnEdit = document.createElement("button");
				btnEdit.classList.add("btn", "btn-warning", "btn-sm", "me-2");
				btnEdit.onclick = () => modificaNome(index);
				let edit_icon = document.createElement("i");
				edit_icon.classList.add("bi", "bi-pencil");
				btnEdit.appendChild(edit_icon);
				
				let btnRimuovi = document.createElement("button");
				btnRimuovi.classList.add("btn", "btn-danger", "btn-sm");
				btnRimuovi.onclick = () => rimuoviNome(index);
				let remove_icon = document.createElement("i");
				remove_icon.classList.add("bi", "bi-trash");
				btnRimuovi.appendChild(remove_icon);
				
				li.appendChild(span);
				div.appendChild(btnEdit);
				div.appendChild(btnRimuovi);
				li.appendChild(div);
				elenco.appendChild(li);
			});
			
			if (personeTotali === numeroTotale) {
				document.getElementById("messaggio").style.display = "block";
				document.getElementById("messaggio").textContent = "Hai completato la lista!";
				generaInvito();
			} else {
				document.getElementById("messaggio").style.display = "none";
				document.getElementById("invito").style.display = "none";
				document.getElementById("copiaInvito").style.display = "none";
			}
		}

        function modificaNome(index) {
            let nuovoNome = prompt("Modifica il nome:", nomi[index].nome);
            let nuovoNumero = parseInt(prompt("Modifica il numero di persone:", nomi[index].numeroPersone));
            
            if (nuovoNome && nuovoNumero > 0) {
                personeTotali -= nomi[index].numeroPersone;
                nomi[index] = { nome: nuovoNome, numeroPersone: nuovoNumero };
                personeTotali += nuovoNumero;
                aggiornaLista();
            }
        }

        function rimuoviNome(index) {
			personeTotali -= nomi[index].numeroPersone;
			nomi.splice(index, 1);
			aggiornaLista();
			aggiornaCounter(); // Aggiorna il contatore
		}

        function generaInvito() {
            let ospiti = nomi.map(n => `${n.nome} (${n.numeroPersone})`).join(", ");
            let invitoText = messaggioBase.replace("{ospiti}", ospiti);
            
            let invito = document.getElementById("invito");
            invito.style.display = "block";
            invito.value = invitoText;
            document.getElementById("copiaInvito").style.display = "inline-block";
        }

        function toggleImpostazioni() {
            let impostazioni = document.getElementById("impostazioni");
            impostazioni.style.display = impostazioni.style.display === "none" ? "block" : "none";
        }
		
		function copiaTesto() {
            var testoInput = document.getElementById("invito");
            testoInput.select();
            testoInput.setSelectionRange(0, 99999);
            document.execCommand("copy");
            alert("Invito copiato negli appunti!");
        }
		
		function aggiornaCounter() {
			let personeRestanti = numeroTotale - personeTotali;
			document.getElementById("personeRestanti").textContent = personeRestanti;
		}
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
